<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MarcaLibros Personalizados</title>

  <!-- Favicon desde URL -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />
  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #2c3e50;
      --header-bg: #ffffff;
      --border-color: #bdc3c7;
      --box-bg: #fff;
      --btn-primary: #3498db;
      --btn-hover: #2980b9;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
      --label-bg: rgba(0,0,0,0.7);
      --footer-bg: #2c3e50;
      --instruction-bg: #fff;
      --instruction-border: #ddd;
    }

    [data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #ecf0f1;
      --header-bg: #1e1e1e;
      --border-color: #555;
      --box-bg: #2d2d2d;
      --btn-primary: #2980b9;
      --btn-hover: #3498db;
      --shadow: 0 4px 12px rgba(0,0,0,0.5);
      --label-bg: rgba(255,255,255,0.7);
      --footer-bg: #0d0d0d;
      --instruction-bg: #2d2d2d;
      --instruction-border: #444;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
      max-width: 1200px;
      margin: 0 auto;
      transition: background-color 0.3s, color 0.3s;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      background-color: var(--header-bg);
      padding: 15px;
      border-radius: 8px;
    }
    .logo {
      width: 80px;
      height: auto;
      border-radius: 8px;
      box-shadow: var(--shadow);
    }
    h1 {
      color: var(--text-color);
      margin: 0;
      font-size: 2rem;
    }
    .subtitle {
      text-align: center;
      color: #7f8c8d;
      margin-bottom: 20px;
    }
    .mode-selector {
      text-align: center;
      margin: 20px 0;
    }
    .mode-btn {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #ecf0f1;
      border: none;
      border-radius: 5px;
      transition: background 0.3s;
    }
    .mode-btn:hover {
      background-color: #d5dbdb;
    }
    .mode-btn.active {
      background-color: var(--btn-primary);
      color: white;
    }
    .upload-section {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }
    .image-box {
      width: 400px;
      height: 400px;
      border: 2px dashed var(--border-color);
      background-color: var(--box-bg);
      position: relative;
      overflow: hidden;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .image-box img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .placeholder {
      font-size: 2rem;
      color: var(--border-color);
      text-align: center;
      padding: 20px;
      pointer-events: none;
    }
    .label {
      position: absolute;
      top: 10px;
      left: 10px;
      background: var(--label-bg);
      color: white;
      padding: 5px 10px;
      font-size: 14px;
      border-radius: 3px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: var(--btn-primary);
      color: white;
      border: none;
      border-radius: 5px;
      transition: background 0.3s;
    }
    button:hover {
      background-color: var(--btn-hover);
    }
    #previewContainer {
      margin-top: 30px;
      text-align: center;
      display: none;
    }
    #previewContainer img {
      width: 5cm;
      height: 15cm;
      object-fit: cover;
      border: 1px solid var(--instruction-border);
      box-shadow: var(--shadow);
      image-rendering: crisp-edges;
      border-radius: 4px;
    }
    #previewContainer.double img {
      width: 10cm;
      height: 15cm;
    }
    .controls {
      text-align: center;
      margin-top: 20px;
    }
    .instructions {
      margin-top: 20px;
      padding: 15px;
      background-color: var(--instruction-bg);
      border: 1px solid var(--instruction-border);
      border-radius: 8px;
      display: none;
    }
    .instructions p {
      margin: 10px 0;
      line-height: 1.6;
      color: var(--text-color);
    }
    footer {
      margin-top: 40px;
      padding: 20px;
      text-align: center;
      background-color: var(--footer-bg);
      color: white;
      border-radius: 8px;
      font-size: 14px;
    }
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: var(--btn-primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
    }
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
      }
      .logo {
        width: 60px;
      }
      .upload-section {
        flex-direction: column;
        align-items: center;
      }
      .image-box {
        width: 90%;
        max-width: 400px;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">üåô</button>

  <div class="header">
    <img src="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png" alt="Logo MarcaLibros" class="logo">
    <h1>MarcaLibros Personalizados</h1>
  </div>
  <p class="subtitle">Crea tu separador ideal: una cara o doble cara, listo para imprimir</p>

  <div class="mode-selector">
    <button class="mode-btn active" data-mode="single">‚úÖ Una cara</button>
    <button class="mode-btn" data-mode="double">üîÑ Doble cara</button>
  </div>

  <!-- Modo Una Cara -->
  <div class="upload-section single-mode">
    <div class="single-only">
      <p><strong>Imagen:</strong></p>
      <input type="file" id="imageUpload1" accept="image/*" style="display:none;" />
      <div class="image-box" id="box1">
        <div class="placeholder">üñºÔ∏è Haz clic o arrastra una imagen aqu√≠</div>
        <img id="image1" src="" alt="Imagen 1" style="display:none;" />
        <div class="label">Cara 1</div>
      </div>
    </div>
  </div>

  <!-- Modo Doble Cara -->
  <div class="upload-section double-mode" style="display:none;">
    <div>
      <p><strong>Imagen 1:</strong></p>
      <input type="file" id="imageUpload1_double" accept="image/*" style="display:none;" />
      <div class="image-box" id="box1_double">
        <div class="placeholder">üñºÔ∏è Haz clic o arrastra una imagen aqu√≠</div>
        <img id="image1_double" src="" alt="Imagen 1" style="display:none;" />
        <div class="label">Cara 1</div>
      </div>
    </div>
    <div>
      <p><strong>Imagen 2:</strong></p>
      <input type="file" id="imageUpload2_double" accept="image/*" style="display:none;" />
      <div class="image-box" id="box2_double">
        <div class="placeholder">üñºÔ∏è Haz clic o arrastra una imagen aqu√≠</div>
        <img id="image2_double" src="" alt="Imagen 2" style="display:none;" />
        <div class="label">Cara 2</div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button id="cropButton">Recortar imagen(es)</button>
    <button id="downloadPdfButton" style="display:none;">üì• PDF (imprimir)</button>
    <button id="downloadPngButton" style="display:none;">üñºÔ∏è PNG (alta calidad)</button>
    <button id="downloadJpgButton" style="display:none;">üì∏ JPG (compartir)</button>
  </div>

  <div id="previewContainer">
    <h3>Tu separador final:</h3>
    <img id="finalPreview" src="" alt="Separador" />
  </div>

  <div class="instructions" id="instructions">
    <h4>üìå Instrucciones de impresi√≥n y armado:</h4>
    <p id="instructionText"></p>
  </div>

  <footer>
    ¬© 2025 Jhorman Jes√∫s Castellanos Morales ‚Äì Todos los derechos reservados.
  </footer>

  <!-- Librer√≠as -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
  <script>
    let cropper1, cropper2;
    let croppedCanvas1, croppedCanvas2;
    let currentMode = 'single';

    // --- Modo Oscuro ---
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    // Detectar preferencia del sistema
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theme');

    if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
      body.setAttribute('data-theme', 'dark');
      themeToggle.textContent = '‚òÄÔ∏è';
    } else {
      body.setAttribute('data-theme', 'light');
      themeToggle.textContent = 'üåô';
    }

    themeToggle.addEventListener('click', () => {
      if (body.getAttribute('data-theme') === 'dark') {
        body.setAttribute('data-theme', 'light');
        themeToggle.textContent = 'üåô';
        localStorage.setItem('theme', 'light');
      } else {
        body.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '‚òÄÔ∏è';
        localStorage.setItem('theme', 'dark');
      }
    });

    // --- Cambiar modo (una/doble cara) ---
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentMode = this.dataset.mode;

        const singleSection = document.querySelector('.single-mode');
        const doubleSection = document.querySelector('.double-mode');
        const previewContainer = document.getElementById('previewContainer');
        const instructions = document.getElementById('instructions');
        const cropButton = document.getElementById('cropButton');
        const downloadPdfButton = document.getElementById('downloadPdfButton');
        const downloadPngButton = document.getElementById('downloadPngButton');
        const downloadJpgButton = document.getElementById('downloadJpgButton');

        if (currentMode === 'single') {
          singleSection.style.display = 'flex';
          doubleSection.style.display = 'none';
        } else {
          singleSection.style.display = 'none';
          doubleSection.style.display = 'flex';
        }

        // Resetear
        previewContainer.style.display = 'none';
        instructions.style.display = 'none';
        cropButton.style.display = 'inline-block';
        downloadPdfButton.style.display = 'none';
        downloadPngButton.style.display = 'none';
        downloadJpgButton.style.display = 'none';

        if (cropper1) cropper1.destroy();
        if (cropper2) cropper2.destroy();
        cropper1 = cropper2 = null;
        document.getElementById('image1').src = '';
        document.getElementById('image1_double').src = '';
        document.getElementById('image2_double').src = '';
        // Restaurar placeholder
        document.getElementById('box1').innerHTML = `
          <div class="placeholder">üñºÔ∏è Haz clic o arrastra una imagen aqu√≠</div>
          <img id="image1" src="" alt="Imagen 1" style="display:none;" />
          <div class="label">Cara 1</div>
        `;
        document.getElementById('box1_double').innerHTML = `
          <div class="placeholder">üñºÔ∏è Haz clic o arrastra una imagen aqu√≠</div>
          <img id="image1_double" src="" alt="Imagen 1" style="display:none;" />
          <div class="label">Cara 1</div>
        `;
        document.getElementById('box2_double').innerHTML = `
          <div class="placeholder">üñºÔ∏è Haz clic o arrastra una imagen aqu√≠</div>
          <img id="image2_double" src="" alt="Imagen 2" style="display:none;" />
          <div class="label">Cara 2</div>
        `;
      });
    });

    // --- Funci√≥n para inicializar cropper ---
    function initCropper(imgElement, inputId, boxId) {
      return new Cropper(imgElement, {
        aspectRatio: 1 / 3,
        viewMode: 1,
        dragMode: 'move',
        cropBoxResizable: true,
        cropBoxMovable: true,
        guides: true,
        center: true,
        highlight: false,
        autoCropArea: 0.8,
        responsive: true,
        zoomOnWheel: true,
        zoomOnTouch: true,
      });
    }

    // --- Manejar carga de imagen con placeholder ---
    function setupImageUploader(inputId, imgId, boxId) {
      const input = document.getElementById(inputId);
      const img = document.getElementById(imgId);
      const box = document.getElementById(boxId);

      box.addEventListener('click', () => input.click());

      input.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
          img.src = event.target.result;
          img.style.display = 'block';
          box.querySelector('.placeholder').style.display = 'none';

          if (imgId === 'image1') {
            if (cropper1) cropper1.destroy();
            cropper1 = initCropper(img, inputId, boxId);
          } else if (imgId === 'image1_double') {
            if (cropper1) cropper1.destroy();
            cropper1 = initCropper(img, inputId, boxId);
          } else if (imgId === 'image2_double') {
            if (cropper2) cropper2.destroy();
            cropper2 = initCropper(img, inputId, boxId);
          }
        };
        reader.readAsDataURL(file);
      });
    }

    // Inicializar los inputs
    setupImageUploader('imageUpload1', 'image1', 'box1');
    setupImageUploader('imageUpload1_double', 'image1_double', 'box1_double');
    setupImageUploader('imageUpload2_double', 'image2_double', 'box2_double');

    // --- Recortar ---
    document.getElementById('cropButton').addEventListener('click', function() {
      if (currentMode === 'single') {
        if (!cropper1) {
          alert("Por favor, sube y recorta la imagen.");
          return;
        }
        croppedCanvas1 = cropper1.getCroppedCanvas({ width: 500, height: 1500 });
        showResult(croppedCanvas1);

      } else {
        if (!cropper1 || !cropper2) {
          alert("Por favor, sube y recorta ambas im√°genes.");
          return;
        }
        croppedCanvas1 = cropper1.getCroppedCanvas({ width: 500, height: 1500 });
        croppedCanvas2 = cropper2.getCroppedCanvas({ width: 500, height: 1500 });

        const combinedCanvas = document.createElement('canvas');
        combinedCanvas.width = 1000;
        combinedCanvas.height = 1500;
        const ctx = combinedCanvas.getContext('2d');
        ctx.drawImage(croppedCanvas1, 0, 0);
        ctx.drawImage(croppedCanvas2, 500, 0);
        showResult(combinedCanvas);
      }
    });

    function showResult(canvas) {
      const preview = document.getElementById('finalPreview');
      preview.src = canvas.toDataURL();
      document.getElementById('previewContainer').classList.toggle('double', currentMode === 'double');
      document.getElementById('previewContainer').style.display = 'block';
      document.getElementById('downloadPdfButton').style.display = 'inline-block';
      document.getElementById('downloadPngButton').style.display = 'inline-block';
      document.getElementById('downloadJpgButton').style.display = 'inline-block';
      document.getElementById('instructions').style.display = 'block';

      const instructionText = document.getElementById('instructionText');
      if (currentMode === 'single') {
        instructionText.innerHTML = `
          <strong>üìÑ Medidas:</strong> 5 cm de ancho √ó 15 cm de alto.<br>
          <strong>üñ®Ô∏è Impresi√≥n:</strong> Papel opalina brillante o mate (180‚Äì250 g/m¬≤).<br>
          <strong>‚úÇÔ∏è Armado:</strong> Recorta con tijeras. ¬°Listo para usar!
        `;
      } else {
        instructionText.innerHTML = `
          <strong>üìÑ Medidas:</strong> 10 cm de ancho √ó 15 cm de alto (5 cm por cara).<br>
          <strong>üñ®Ô∏è Impresi√≥n:</strong> Papel opalina o fotogr√°fico (200‚Äì250 g/m¬≤).<br>
          <strong>‚úÇÔ∏è Armado:</strong> Recorta, dobla por la mitad y pega con pegamento en barra.
        `;
      }
      window.finalCanvas = canvas;
    }

    // --- Descargas ---
    document.getElementById('downloadPdfButton').addEventListener('click', function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
      const imgData = window.finalCanvas.toDataURL('image/png');
      const widthMM = currentMode === 'single' ? 50 : 100;
      const heightMM = 150;
      const x = (210 - widthMM) / 2;
      const y = (297 - heightMM) / 2;
      doc.addImage(imgData, 'PNG', x, y, widthMM, heightMM);
      doc.setFontSize(16);
      doc.text(`Separador de ${currentMode === 'single' ? 'una cara' : 'doble cara'}`, x, y - 5);
      doc.setFontSize(10);
      doc.text([
        `‚Ä¢ Medidas: ${widthMM}mm √ó ${heightMM}mm`,
        `‚Ä¢ Papel: Opalina o fotogr√°fico (200‚Äì250 g/m¬≤)`,
        `‚Ä¢ Armado: Recortar y, si es doble cara, doblar y pegar.`
      ], x, y + heightMM + 15, { maxWidth: 180 });
      doc.save(currentMode === 'single' ? 'separador-una-cara.pdf' : 'separador-doble-cara.pdf');
    });

    document.getElementById('downloadPngButton').addEventListener('click', function() {
      const link = document.createElement('a');
      link.download = currentMode === 'single' ? 'separador-una-cara.png' : 'separador-doble-cara.png';
      link.href = window.finalCanvas.toDataURL('image/png');
      link.click();
    });

    document.getElementById('downloadJpgButton').addEventListener('click', function() {
      const link = document.createElement('a');
      link.download = currentMode === 'single' ? 'separador-una-cara.jpg' : 'separador-doble-cara.jpg';
      link.href = window.finalCanvas.toDataURL('image/jpeg', 0.95);
      link.click();
    });
  </script>
</body>
</html>
